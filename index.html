<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrats SAV - Application de gestion</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="sidebar__brand">
        <span class="sidebar__logo">SAV</span>
        <div>
          <p class="sidebar__title">Contrats de service</p>
          <p class="sidebar__subtitle">Module back-office</p>
        </div>
      </div>
      <nav class="sidebar__nav">
        <a href="#overview" class="nav-link is-active">Vue d’ensemble</a>
        <a href="#data-model" class="nav-link">Modèle de données</a>
        <a href="#rules" class="nav-link">Règles SAV</a>
        <a href="#workflow" class="nav-link">Workflows</a>
        <a href="#management" class="nav-link">Gestion</a>
        <a href="#decision" class="nav-link">Décision couverture</a>
        <a href="#api" class="nav-link">API &amp; endpoints</a>
        <a href="#demo" class="nav-link">Démo &amp; seed</a>
      </nav>
      <div class="sidebar__footer">
        <p>Version 1 - base fonctionnelle</p>
      </div>
    </aside>

    <main class="content">
      <header class="page-header" id="overview">
        <div>
          <p class="eyebrow">Cahier des charges fonctionnel</p>
          <h1>Gestion des contrats de service SAV</h1>
          <p class="subtitle">
            Application interne pour créer des contrats SAV, structurer les appendix et piloter les règles de
            couverture par produit.
          </p>
        </div>
        <div class="status-card">
          <h2>Objectifs clés</h2>
          <ul>
            <li>Créer et gérer des contrats SAV avec les clients industriels.</li>
            <li>Configurer les règles de garantie par produit.</li>
            <li>Exposer les règles au front-office (API-first).</li>
          </ul>
        </div>
      </header>

      <section class="section">
        <h2>Contexte métier</h2>
        <p>
          Les contrats SAV couvrent des clients industriels asiatiques opérant sur les marchés du jardinage et du
          bricolage. Les produits sont fabriqués par les usines clientes, vendus en Europe et pris en charge par
          notre société dans une logique assurantielle.
        </p>
        <div class="grid grid--three">
          <article class="card">
            <h3>Contrats</h3>
            <p>Accord global, règles financières et durée de validité.</p>
          </article>
          <article class="card">
            <h3>Appendix</h3>
            <p>Lots de produits homogènes rattachés à un contrat.</p>
          </article>
          <article class="card">
            <h3>Lignes</h3>
            <p>Produit spécifique avec règles de garantie et options SAV.</p>
          </article>
        </div>
      </section>

      <section class="section" id="data-model">
        <div class="section__header">
          <h2>Modèle de données</h2>
          <p>Vue synthétique des entités principales et de leurs champs clés.</p>
        </div>
        <div class="grid grid--three">
          <article class="card">
            <h3>Contrat</h3>
            <ul>
              <li>client_id, reference (unique par client)</li>
              <li>status : draft | active | suspended | expired | archived</li>
              <li>start_date, end_date</li>
              <li>billing_rate_percent, billing_base</li>
              <li>currency, notes</li>
            </ul>
          </article>
          <article class="card">
            <h3>Appendix</h3>
            <ul>
              <li>contract_id, name, code</li>
              <li>status : draft | active | archived</li>
              <li>start_date, end_date</li>
              <li>description</li>
            </ul>
          </article>
          <article class="card">
            <h3>Ligne de contrat</h3>
            <ul>
              <li>appendix_id, product_id</li>
              <li>status : draft | active | deprecated</li>
              <li>warranty_start_rule, warranty_months</li>
              <li>options garantie &amp; hors garantie</li>
            </ul>
          </article>
        </div>
        <div class="constraints">
          <h3>Contraintes</h3>
          <ul>
            <li>Dates cohérentes : line ⩽ appendix ⩽ contrat.</li>
            <li>Une ligne appartient à un seul appendix.</li>
            <li>Activation contrat interdite sans ligne active.</li>
          </ul>
        </div>
      </section>

      <section class="section" id="rules">
        <div class="section__header">
          <h2>Règles de prise en charge SAV</h2>
          <p>Les options sont configurées par contrat, appendix et produit.</p>
        </div>
        <div class="grid grid--two">
          <article class="card">
            <h3>Prise en charge garantie</h3>
            <ul>
              <li>Réparation en station agréée</li>
              <li>Envoi de pièces détachées</li>
              <li>Remboursement</li>
              <li>Remplacement produit</li>
            </ul>
          </article>
          <article class="card">
            <h3>Hors garantie</h3>
            <ul>
              <li>Réparation payante</li>
              <li>Vente de pièces détachées</li>
            </ul>
          </article>
        </div>
      </section>

      <section class="section" id="workflow">
        <div class="section__header">
          <h2>Workflows &amp; statuts</h2>
          <p>Règles d’édition et transitions applicables en démonstration.</p>
        </div>
        <div class="grid grid--three">
          <article class="card">
            <h3>Contrat</h3>
            <ul>
              <li>draft → active (si appendix &amp; lignes actives)</li>
              <li>active → suspended → active</li>
              <li>active → expired → archived</li>
            </ul>
          </article>
          <article class="card">
            <h3>Appendix</h3>
            <ul>
              <li>draft → active</li>
              <li>active → archived (sans ligne active)</li>
            </ul>
          </article>
          <article class="card">
            <h3>Lignes</h3>
            <ul>
              <li>draft → active</li>
              <li>active → deprecated</li>
            </ul>
          </article>
        </div>
      </section>

      <section class="section" id="management">
        <div class="section__header">
          <h2>Gestion opérationnelle</h2>
          <p>Création rapide des contrats, appendix et lignes de contrat pour la démo.</p>
        </div>
        <div class="grid grid--three">
          <article class="card card--panel">
            <h3>Contrats</h3>
            <div class="table" id="contracts-table"></div>
            <form class="inline-form" id="contract-form">
              <div class="field">
                <label for="contract-client">Client</label>
                <input type="text" id="contract-client" name="contract-client" placeholder="CL-ASI-03" required>
              </div>
              <div class="field">
                <label for="contract-reference">Référence</label>
                <input type="text" id="contract-reference" name="contract-reference" placeholder="SAV-2026" required>
              </div>
              <div class="field">
                <label for="contract-status">Statut</label>
                <select id="contract-status" name="contract-status">
                  <option value="draft">draft</option>
                  <option value="active">active</option>
                  <option value="suspended">suspended</option>
                  <option value="expired">expired</option>
                </select>
              </div>
              <div class="field">
                <label for="contract-start">Date début</label>
                <input type="date" id="contract-start" name="contract-start" required>
              </div>
              <div class="field">
                <label for="contract-end">Date fin</label>
                <input type="date" id="contract-end" name="contract-end" required>
              </div>
              <div class="field">
                <label for="contract-rate">Taux facturation (%)</label>
                <input type="number" step="0.1" id="contract-rate" name="contract-rate" value="5.0" required>
              </div>
              <div class="field">
                <label for="contract-billing">Base de facturation</label>
                <select id="contract-billing" name="contract-billing">
                  <option value="purchase_cost">purchase_cost</option>
                  <option value="retail_price">retail_price</option>
                </select>
              </div>
              <div class="field">
                <label for="contract-currency">Devise</label>
                <input type="text" id="contract-currency" name="contract-currency" value="EUR">
              </div>
              <div class="field">
                <label for="contract-notes">Notes</label>
                <input type="text" id="contract-notes" name="contract-notes" placeholder="Commentaire interne">
              </div>
              <button type="submit" class="primary-button">Ajouter contrat</button>
              <p class="form-message" id="contract-message" role="status"></p>
            </form>
          </article>
          <article class="card card--panel">
            <h3>Appendix</h3>
            <div class="table" id="appendices-table"></div>
            <form class="inline-form" id="appendix-form">
              <div class="field">
                <label for="appendix-contract">Contrat</label>
                <select id="appendix-contract" name="appendix-contract"></select>
              </div>
              <div class="field">
                <label for="appendix-name">Nom</label>
                <input type="text" id="appendix-name" name="appendix-name" placeholder="Gamme Jardin 2026" required>
              </div>
              <div class="field">
                <label for="appendix-code">Code</label>
                <input type="text" id="appendix-code" name="appendix-code" placeholder="GJ-2026" required>
              </div>
              <div class="field">
                <label for="appendix-status">Statut</label>
                <select id="appendix-status" name="appendix-status">
                  <option value="draft">draft</option>
                  <option value="active">active</option>
                  <option value="archived">archived</option>
                </select>
              </div>
              <div class="field">
                <label for="appendix-start">Date début</label>
                <input type="date" id="appendix-start" name="appendix-start" required>
              </div>
              <div class="field">
                <label for="appendix-end">Date fin</label>
                <input type="date" id="appendix-end" name="appendix-end" required>
              </div>
              <div class="field">
                <label for="appendix-description">Description</label>
                <input type="text" id="appendix-description" name="appendix-description" placeholder="Description rapide">
              </div>
              <button type="submit" class="primary-button">Ajouter appendix</button>
              <p class="form-message" id="appendix-message" role="status"></p>
            </form>
          </article>
          <article class="card card--panel">
            <h3>Lignes de contrat</h3>
            <div class="table" id="lines-table"></div>
            <form class="inline-form" id="line-form">
              <div class="field">
                <label for="line-appendix">Appendix</label>
                <select id="line-appendix" name="line-appendix"></select>
              </div>
              <div class="field">
                <label for="line-product">Produit</label>
                <select id="line-product" name="line-product"></select>
              </div>
              <div class="field">
                <label for="line-status">Statut</label>
                <select id="line-status" name="line-status">
                  <option value="draft">draft</option>
                  <option value="active">active</option>
                  <option value="deprecated">deprecated</option>
                </select>
              </div>
              <div class="field">
                <label for="line-start">Date début</label>
                <input type="date" id="line-start" name="line-start" required>
              </div>
              <div class="field">
                <label for="line-end">Date fin</label>
                <input type="date" id="line-end" name="line-end" required>
              </div>
              <div class="field">
                <label for="line-rule">Départ garantie</label>
                <select id="line-rule" name="line-rule">
                  <option value="purchase_date">purchase_date</option>
                  <option value="activation_date">activation_date</option>
                  <option value="manufacture_date">manufacture_date</option>
                </select>
              </div>
              <div class="field">
                <label for="line-months">Durée garantie (mois)</label>
                <input type="number" id="line-months" name="line-months" value="24" required>
              </div>
              <div class="field">
                <label for="line-serial">Numéro de série requis</label>
                <select id="line-serial" name="line-serial">
                  <option value="true">Oui</option>
                  <option value="false">Non</option>
                </select>
              </div>
              <div class="field">
                <label for="line-serial-pattern">Format série (regex)</label>
                <input type="text" id="line-serial-pattern" name="line-serial-pattern" placeholder="^SAV-\\d{4}-\\d{3}$">
              </div>
              <div class="field">
                <label for="line-proof">Preuve d'achat</label>
                <select id="line-proof" name="line-proof">
                  <option value="true">Oui</option>
                  <option value="false">Non</option>
                </select>
              </div>
              <div class="field">
                <label for="line-countries">Pays autorisés</label>
                <input type="text" id="line-countries" name="line-countries" placeholder="FR, BE, ES">
              </div>
              <div class="field">
                <label for="line-channels">Canaux autorisés</label>
                <input type="text" id="line-channels" name="line-channels" placeholder="retail, online">
              </div>
              <div class="field">
                <label for="line-options">Options SAV</label>
                <div class="option-grid" id="line-options">
                  <label><input type="checkbox" name="options" value="repair_station" checked> Station agréée</label>
                  <label><input type="checkbox" name="options" value="parts_shipment"> Envoi pièces</label>
                  <label><input type="checkbox" name="options" value="refund"> Remboursement</label>
                  <label><input type="checkbox" name="options" value="replacement"> Remplacement</label>
                  <label><input type="checkbox" name="options" value="paid_repair"> Réparation payante</label>
                  <label><input type="checkbox" name="options" value="parts_sale"> Vente pièces</label>
                </div>
              </div>
              <button type="submit" class="primary-button">Ajouter ligne</button>
              <p class="form-message" id="line-message" role="status"></p>
            </form>
          </article>
        </div>
      </section>

      <section class="section" id="decision">
        <div class="section__header">
          <h2>Moteur de décision - couverture SAV</h2>
          <p>Simulateur basé sur les règles de l’annexe A.5.</p>
        </div>
        <div class="decision">
          <form class="decision__form" id="decision-form">
            <div class="field">
              <label for="scope">Périmètre</label>
              <select id="scope" name="scope">
                <option value="contract">Recherche par contrat</option>
                <option value="appendix">Recherche par appendix</option>
              </select>
            </div>
            <div class="field">
              <label for="contract">Contrat</label>
              <select id="contract" name="contract"></select>
            </div>
            <div class="field">
              <label for="appendix">Appendix</label>
              <select id="appendix" name="appendix"></select>
            </div>
            <div class="field">
              <label for="product">Produit</label>
              <select id="product" name="product"></select>
            </div>
            <div class="field">
              <label for="event-date">Date de demande SAV</label>
              <input type="date" id="event-date" name="event-date" required>
            </div>
            <div class="field">
              <label for="serial">Numéro de série</label>
              <input type="text" id="serial" name="serial" placeholder="Ex: SAV-2024-001">
            </div>
            <div class="field">
              <label for="purchase-date">Date d'achat</label>
              <input type="date" id="purchase-date" name="purchase-date">
            </div>
            <div class="field">
              <label for="activation-date">Date d'activation</label>
              <input type="date" id="activation-date" name="activation-date">
            </div>
            <div class="field">
              <label for="manufacture-date">Date de fabrication</label>
              <input type="date" id="manufacture-date" name="manufacture-date">
            </div>
            <div class="field">
              <label for="proof">Preuve d'achat fournie</label>
              <select id="proof" name="proof">
                <option value="">Non renseigné</option>
                <option value="true">Oui</option>
                <option value="false">Non</option>
              </select>
            </div>
            <div class="field">
              <label for="country">Pays de vente</label>
              <input type="text" id="country" name="country" placeholder="Ex: FR">
            </div>
            <div class="field">
              <label for="channel">Canal de distribution</label>
              <input type="text" id="channel" name="channel" placeholder="Ex: retail">
            </div>
            <button type="submit" class="primary-button">Évaluer la couverture</button>
          </form>
          <div class="decision__output">
            <h3>Résultat</h3>
            <div class="output__grid">
              <div>
                <p class="output__label">Éligibilité</p>
                <p class="output__value" id="output-eligible">-</p>
              </div>
              <div>
                <p class="output__label">Sous garantie</p>
                <p class="output__value" id="output-warranty">-</p>
              </div>
              <div>
                <p class="output__label">Fin de garantie</p>
                <p class="output__value" id="output-warranty-end">-</p>
              </div>
            </div>
            <div class="output__section">
              <p class="output__label">Inputs requis</p>
              <div class="tag-list" id="output-required"></div>
            </div>
            <div class="output__section">
              <p class="output__label">Options SAV autorisées</p>
              <div class="tag-list" id="output-options"></div>
            </div>
            <div class="output__section">
              <p class="output__label">Reason codes</p>
              <div class="tag-list" id="output-reasons"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="section" id="api">
        <div class="section__header">
          <h2>API Back (CRUD) - démo</h2>
          <p>Endpoints clés exposés par le module Contrats / Appendix / Lignes.</p>
        </div>
        <div class="grid grid--two">
          <article class="card">
            <h3>Contrats</h3>
            <ul>
              <li>POST /contracts</li>
              <li>GET /contracts</li>
              <li>GET /contracts/{id}</li>
              <li>PATCH /contracts/{id}</li>
              <li>POST /contracts/{id}/activate</li>
              <li>POST /contracts/{id}/suspend</li>
            </ul>
          </article>
          <article class="card">
            <h3>Appendix &amp; lignes</h3>
            <ul>
              <li>POST /contracts/{id}/appendices</li>
              <li>GET /appendices/{id}</li>
              <li>POST /appendices/{id}/lines</li>
              <li>GET /appendices/{id}/lines</li>
              <li>POST /contract-lines/{id}/activate</li>
              <li>POST /contract-lines/{id}/deprecate</li>
            </ul>
          </article>
        </div>
        <div class="card highlight">
          <h3>Endpoint décision</h3>
          <code>POST /decisions/coverage</code>
          <p>Retourne eligible, in_warranty, allowed_resolutions et reason_codes.</p>
        </div>
      </section>

      <section class="section" id="demo">
        <div class="section__header">
          <h2>Démo &amp; données de seed</h2>
          <p>Exemples d’appels et critères d’acceptation pour la démonstration.</p>
        </div>
        <div class="grid grid--two">
          <article class="card">
            <h3>Script de démo</h3>
            <ol>
              <li>Créer un contrat (client existant).</li>
              <li>Créer 1 appendix.</li>
              <li>Ajouter 3 lignes.</li>
              <li>Activer appendix puis contrat.</li>
              <li>Tester 5 cas de /decisions/coverage.</li>
            </ol>
          </article>
          <article class="card">
            <h3>Critères d’acceptation</h3>
            <ul>
              <li>Validation du product_id à la création d’une ligne.</li>
              <li>Activation contrat impossible sans ligne active.</li>
              <li>Reason codes cohérents et reproductibles.</li>
              <li>Contraintes de validité appliquées partout.</li>
            </ul>
          </article>
        </div>
      </section>
    </main>
  </div>

  <script src="script.js"></script>
</body>
</html>
